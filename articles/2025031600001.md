---
title: "GoogleNewsAPIã‚’ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ¦†"
type: "idea"
topics:
  - "GAS"
published: true
published_at: "2025-03-16 20:00"
---

# ãªãœä½œæˆã—ãŸã®ã‹
- ä»Šå¾ŒDifyè©¦ã—ã¦ã¿ãŸã„ã‘ã©æ‰‹æ•°ãŒå°‘ãªã„ã®ã§ä½¿ãˆã‚‹APIã‚’å¢—ã‚„ã—ã¦ã„ããŸã„æ°—æŒã¡

# æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- Google Spreadsheet
- Gemin API
- [Google News API(Developer)](https://newsapi.org/)

# ãŠè©¦ã—ã™ã‚‹å‡¦ç†ã®ãƒ—ãƒ©ãƒ³
- GAS ã§GoogleNewsAPIã‚’å‘¼ã³å‡ºã—ã¦ã€æƒ…å ±æ¼æ´©ã€ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚’ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ç™ºç”Ÿæ—¥é †ã§10ä»¶ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ï¼ˆä¼æ¥­ã®æƒ…å ±æ¼æ´©äº‹æ¡ˆã¨ã‹ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ã¨ã„ã„ãªï¼‰
- å–å¾—ã—ãŸãƒªã‚¹ãƒˆã®URLã‚’Geminiã«æ¸¡ã—ã¦è¦ç´„ã—ã€åˆ†é¡ã¨ã‹ã®å±æ€§æƒ…å ±ã‚’æ¨æ¸¬ã€ä»˜åŠ ã—ã¦ã‚‚ã‚‰ã†
- ç”Ÿæˆã—ãŸæƒ…å ±ã‚’Spreadsheetã«è¿½åŠ ã™ã‚‹

# å®Ÿéš›ã«å®Ÿè£…ã—ãŸå†…å®¹

```javascript
function fetchSecurityIncidents() {
  const scriptProperties = PropertiesService.getScriptProperties();
  const NEWS_API_KEY = scriptProperties.getProperty("NEWS_API_KEY");
  const GEMINI_API_KEY = scriptProperties.getProperty("GEMINI_API_KEY");
  const SPREADSHEET_ID = scriptProperties.getProperty("SPREADSHEET_ID");

  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName("Security Incidents") || SpreadsheetApp.openById(SPREADSHEET_ID).insertSheet("Security Incidents");

  // ãƒ˜ãƒƒãƒ€ãƒ¼ãŒãªã‘ã‚Œã°ä½œæˆ
  if (sheet.getLastRow() === 0) {
    sheet.appendRow(["æ¤œå‡ºæ—¥", "ã‚¿ã‚¤ãƒˆãƒ«", "å ±å‘Šçµ„ç¹”", "æ¦‚è¦", "æ¥­ç•Œ", "äº‹è±¡åˆ†é¡", "å ±å‘Šçµ„ç¹”ã®å…¬è¡¨URL"]);
  }

  // const query = encodeURIComponent("security incident OR data breach OR information leak");
  const query = encodeURIComponent("ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ OR æƒ…å ±æ¼æ´© OR ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹");
  const url = `https://newsapi.org/v2/everything?q=${query}&language=jp&sortBy=publishedAt&pageSize=10&apiKey=${NEWS_API_KEY}`;

  const response = UrlFetchApp.fetch(url);
  const articles = JSON.parse(response.getContentText()).articles;

  articles.forEach(article => {
    const { title, description, url, publishedAt, source } = article;

    //const summaryData = analyzeWithGemini(title + " " + description, GEMINI_API_KEY);
    const summaryData = analyzeWithGemini(url, GEMINI_API_KEY);
    const { organization, industry, category } = summaryData;

    sheet.appendRow([
      publishedAt.split('T')[0], // æ¤œå‡ºæ—¥
      title, // ã‚¿ã‚¤ãƒˆãƒ«
      organization, // å ±å‘Šçµ„ç¹”
      description, // æ¦‚è¦
      industry, // æ¥­ç•Œ
      category, // äº‹è±¡åˆ†é¡
      url // å ±å‘Šçµ„ç¹”ã®å…¬è¡¨URL
    ]);
  });
}

function analyzeWithGemini(content, GEMINI_API_KEY) {
  const geminiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=" + GEMINI_API_KEY;

  const payload = {
              'contents': [
                {
                  'parts': [{
                    'text': `æ¬¡ã®è¨˜äº‹ã‚’è¦ç´„ã—ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’æ¨æ¸¬ã€è­˜åˆ¥ã—ã¦ãã ã•ã„:\n\nè¨˜äº‹: ${content}\n\n1. å ±å‘Šçµ„ç¹”å\n2. æ¥­ç•Œ\n3. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®åˆ†é¡ (ä¾‹: å†…éƒ¨ä¸æ­£ã€å¤–éƒ¨æ”»æ’ƒãªã©)`
                  }]
                }
              ]
            };

  const options = {
    method: "post",
    contentType: "application/json",
    payload: JSON.stringify(payload)
  };

  const response = UrlFetchApp.fetch(geminiUrl, options);
  const data = JSON.parse(response.getContentText());
  const result = data.candidates[0].content.parts[0].text;

  // Geminiã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æ
  const matches = result.match(/å ±å‘Šçµ„ç¹”å: (.*?)\næ¥­ç•Œ: (.*?)\nã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®åˆ†é¡: (.*)/);
  if (matches) {
    return {
      organization: matches[1].trim(),
      industry: matches[2].trim(),
      category: matches[3].trim()
    };
  }

  return { organization: "ä¸æ˜", industry: "ä¸æ˜", category: "ä¸æ˜" };
}


```

# å®Ÿè¡Œçµæœ

![](/images/2025031600001/2025031601.png)

- News APIã®å–å¾—ã¯ã§ãã‚‹ã‚‚ã®ã®ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã§ã¯æ„å›³ã—ãªã„æƒ…å ±ãŒå¼•ã£ã‹ã‹ã‚‹
  - ã“ã‚Œã¯NewsAPIã®ã‚¯ã‚¨ãƒªã€å–å¾—çµæœã®ãƒ•ã‚£ãƒ«ã‚¿ã‚’å·¥å¤«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- Geminiã«ã„ã„æ„Ÿã˜ã«åˆ†é¡ã—ã¦ã‚‚ã‚‰ãŠã†ã¨æ€ã£ãŸã‘ã©ã€ãã‚‚ãã‚‚ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãŒæ„å›³ã«æ²¿ã£ãŸãƒªã‚¹ãƒˆã«ãªã£ã¦ãªã„ã‹ã‚‰å€‹ã€…ã‚‚ã†ã¾ãã„ã£ã¦ã„ãªã„ã€‚

# æ‰€æ„Ÿ
- ã¨ã‚Šã‚ãˆãšAPIã®é€£æºã¯ã§ãã¦ã‚‹ã‹ã‚‰ã€ä½¿ã„ã“ãªã™ãŸã‚ã®æ–¹æ³•ã‚„ã‚¯ã‚¨ãƒªã«ã¤ã„ã¦ã¯ç”ŸæˆAIã¨å£æ‰“ã¡ã—ã¦ã¿ã‚ˆã†



