---
title: "å®˜å…¬éœ€æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ æ¤œç´¢APIã‚’ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ¦†"
type: "idea"
topics:
  - "GAS"
published: true
published_at: "2025-03-17 20:00"
---

# ãªãœä½œæˆã—ãŸã®ã‹
- ä»Šæ—¥ã¯ãŠæ‰‹è»½ã«è©¦ã›ãã†ãªå®˜å…¬éœ€æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ æ¤œç´¢APIã‚’ä½¿ã£ã¦ã¿ã‚‹

# æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- Google Spreadsheet
- Gemin API
- [å®˜å…¬éœ€æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ æ¤œç´¢APIï¼ˆPDFï¼‰](https://www.kkj.go.jp/doc/ja/api_guide.pdf)

# ãŠè©¦ã—ã™ã‚‹å‡¦ç†ã®ãƒ—ãƒ©ãƒ³
- GAS ã§å®˜å…¬éœ€æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ æ¤œç´¢APIã‚’å‘¼ã³å‡ºã—ã¦ã€ãã®æ—¥ã«å…¬é–‹ã•ã‚ŒãŸå…¥æœ­æƒ…å ±ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹
- ç”Ÿæˆã—ãŸæƒ…å ±ã‚’Spreadsheetã«è¿½åŠ ã™ã‚‹

# å®Ÿéš›ã«å®Ÿè£…ã—ãŸå†…å®¹

```javascript
function fetchProcurementData() {
  const scriptProperties = PropertiesService.getScriptProperties();
  const apiUrl = scriptProperties.getProperty('API_URL');
  const query = scriptProperties.getProperty('QUERY');
  const spreadsheetId = scriptProperties.getProperty('SPREADSHEET_ID');

  const today = new Date();
  const formattedDate = Utilities.formatDate(today, 'JST', 'yyyy-MM-dd');
  const params = {
    method: 'get',
//    payload: {
//      Query: query,
//      CFT_Issue_Date: `${formattedDate}/`
//    }
  };

  const xquery = apiUrl + '?Query=' + query + '&CFT_Issue_Date=' + formattedDate;

  //const response = UrlFetchApp.fetch(apiUrl + '?' + new URLSearchParams(params.payload), params);
  const response = UrlFetchApp.fetch(xquery, params);
  const xml = response.getContentText();
  const document = XmlService.parse(xml);
  const root = document.getRootElement();
  const searchResults = root.getChild('SearchResults');
  const searchResult = searchResults.getChildren('SearchResult');

  const sheet = SpreadsheetApp.openById(spreadsheetId).getSheetByName('ProcurementData') ||
                SpreadsheetApp.openById(spreadsheetId).insertSheet('ProcurementData');

  // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚»ãƒƒãƒˆ
  if (sheet.getLastRow() === 0) {
    sheet.appendRow(['æ¡ˆä»¶å', 'æ©Ÿé–¢å', 'å…¬å‘Šæ—¥', 'ç´å…¥æœŸé™æ—¥', 'URL']);
  }

  // ãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥
  searchResult.forEach(item => {
    const projectName = item.getChildText('ProjectName');
    const organizationName = item.getChildText('OrganizationName');
    const cftIssueDate = item.getChildText('CftIssueDate');
    const periodEndTime = item.getChildText('PeriodEndTime');
    const externalDocumentURI = item.getChildText('ExternalDocumentURI');
    sheet.appendRow([projectName, organizationName, cftIssueDate, periodEndTime, externalDocumentURI]);
  });

  Logger.log('ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚');
}



```

# å®Ÿè¡Œçµæœ

![](/images/2025031700001/2025031701.png)

- è¿”ã‚Šå€¤ã¯XML
- æ—¥ã‚’æŒ‡å®šã—ãŸæƒ…å ±å–å¾—ã¯æ„å›³é€šã‚Šã«å‹•ä½œ
- æ¯æ—¥ãƒˆãƒªã‚¬ãƒ¼å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç©ã¿ä¸Šã’ã§ãã‚‹


# æ‰€æ„Ÿ
- ãŸã æƒ…å ±ã‚’ç©ã¿ä¸Šã’ã‚‹ã ã‘ãªã‚‰ã€ã‚µã‚¤ãƒˆã‹ã‚‰ç›´æ¥æƒ…å ±å‚ç…§ã™ã‚Œã°ã‚ˆã„å°¾ã ã‘ãªã®ã§ã€æ¯æ—¥æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ç”ŸæˆAIã‚’ç”¨ã„ãŸæƒ…å ±ä»˜åŠ ã€æ´å¯Ÿã‚’ã¤ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ä½•ã‹ã—ã‚‰ã®ä¾¡å€¤ãŒå‡ºã›ã‚‹ã¨ã„ã„ãª



