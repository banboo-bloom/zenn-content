---
title: "ã€GASã€‘WindowsOSã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨CVEæƒ…å ±ã‚’ç´ã¥ã‘ã¦ã¿ã‚‹ï¼ˆé€”ä¸­ï¼‰"
emoji: "ğŸ¦†"
type: "idea"
topics:
  - "GAS"
published: true
published_at: "2025-03-21 20:00"
---

# ãªãœä½œæˆã—ãŸã®ã‹
- æ˜¨æ—¥macOSã§å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã‚’Windowså´ã§ã‚‚å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã¨ã„ã†è©¦ã¿

# æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- Google Spreadsheet
- GAS
- [MSRC-Microsoft-Security-Updates-API](https://github.com/microsoft/MSRC-Microsoft-Security-Updates-API)
- [NVD CVE API](https://nvd.nist.gov/developers/vulnerabilities)

# ã‚„ã‚ŠãŸã„ã“ã¨
- MSRCã®APIã‹ã‚‰WindowsOSã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã€é–¢é€£CVEç•ªå·ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹
- ç™»å ´ã™ã‚‹CVEç•ªå·ã«ã¤ã„ã¦NVDã®APIã§è©³ç´°æƒ…å ±ã‚’å–å¾—ã™ã‚‹
- Appsheetã§OSãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨CVEæƒ…å ±ã‚’ç´ã¥ã‘ã¦è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

# GASï¼ˆä½œæˆä¸­ï¼‰

- APIã‚’è©¦ã—æ‰“ã¡ã—ã¦ã„ã¦æ°—ãŒä»˜ã„ãŸãŒã€ã‚ã‚‹APIã¯å€¤ã‚’JSONå½¢å¼ã§è¿”å´ã™ã‚‹ã‚‚ã®ã®ã€ã‚ã‚‹APIã¯XMLå½¢å¼ã§è¿”å´ã™ã‚‹ã¨ã„ã†è¬ãªä»•æ§˜

```javascript
// ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’å–å¾—
const SPREADSHEET_ID = PropertiesService.getScriptProperties().getProperty('SPREADSHEET_ID');
const MSRC_API_UPDATES_URL = 'https://api.msrc.microsoft.com/cvrf/v3.0/updates/';

function main() {
  // Updateãƒªã‚¹ãƒˆã‚’å–å¾—
  const updateData = fetchMsrcUpdateData();
  const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);

  updateWindowsVersionSheet(spreadsheet, updateData);

  // updateWindowsVersionSheet(spreadsheet, data);
  // updateWindowsVersionCVEsSheet(spreadsheet, data);
  // updateWindowsExploitedCVEsSheet(spreadsheet, data);
  // updateWorkCVEsSheet(spreadsheet, data);
  // updateCVEsSheet(spreadsheet);
}

function fetchMsrcUpdateData() {
  // è¿”ã‚Šå€¤ã¯JSONå½¢å¼
  const response = UrlFetchApp.fetch(MSRC_API_UPDATES_URL);
  return JSON.parse(response.getContentText());
}

function updateWindowsVersionSheet(spreadsheet, data) {
  const sheet = getOrCreateSheet(spreadsheet, 'WindowsVersion');
  sheet.clear();
  sheet.appendRow(['ID', 'Alias', 'DocumentTitle', 'Severity','InitialReleaseDate','CurrentReleaseDate', 'CvrfUrl']);

  const cveSheet = getOrCreateSheet(spreadsheet, 'WindowsVersion-CVEs');
  cveSheet.clear();
  cveSheet.appendRow(['id', 'CVE', 'ProductID']);

  const productSheet = getOrCreateSheet(spreadsheet, 'WindowsProduct');
  productSheet.clear();
  productSheet.appendRow(['ProductID', 'FullProductName']);

  data.value.forEach(entry => {
    sheet.appendRow([
      entry.ID || '',
      entry.Alias || '',
      entry.DocumentTitle || '',
      entry.Severity || '',
      entry.InitialReleaseDate || '',
      entry.CurrentReleaseDate || '',
      entry.CvrfUrl || ''
    ]);
    if(entry.CvrfUrl){
      // è¿”ã‚Šå€¤ã¯XMLå½¢å¼
      const urlResponse = UrlFetchApp.fetch(entry.CvrfUrl);
      var xmlDoc = XmlService.parse(urlResponse.getContentText());
      var rootDoc = xmlDoc.getRootElement();
      updateWindowsVersionCVEsSheet(cveSheet,rootDoc,entry.ID);
    }
  });

}


function updateWindowsVersionCVEsSheet(sheet, data, id) {
  var ns = XmlService.getNamespace("vuln", "http://www.icasi.org/CVRF/schema/vuln/1.1");
  var vulnerabilitys  = data.getChildren("Vulnerability",ns);
  vulnerabilitys.forEach(entry => {
    var cve = entry.getChildren("CVE",ns)[0].getValue();
    var productIDs = entry.getChildren("ProductStatuses",ns)[0].getChildren("Status",ns)[0].getChildren("ProductID",ns);
    productIDs.forEach(pdata => {
      sheet.appendRow([
        id,
        cve,
        pdata.getValue()
      ])
    });
  }) ;
}

function updateWindowsProductSheet(sheet, data) {
ï¼ˆå®Ÿè£…ä¸­ï¼‰
}


function updateWindowsExploitedCVEsSheet(spreadsheet, data) {
ï¼ˆå®Ÿè£…ä¸­ï¼‰
}

function updateWorkWinCVEsSheet(spreadsheet, url) {
ï¼ˆå®Ÿè£…ä¸­ï¼‰
}

function updateCVEsSheet(spreadsheet) {
ï¼ˆå®Ÿè£…ä¸­ï¼‰
}

function getOrCreateSheet(spreadsheet, sheetName) {
  const sheet = spreadsheet.getSheetByName(sheetName);
  return sheet || spreadsheet.insertSheet(sheetName);
}

```

# æ‰€æ„Ÿ
- XMLã®ç½ ã«å¼•ã£ã‹ã‹ã£ãŸãŸã‚åœæ»ä¸­ã€‚ã‚‚ã¡ã‚ã‚“JSONå‰æã§å®Ÿè£…ã—ã¦ããŸChatGPTãã‚“ã«ã¯æ³¨æ„ã—ã¦ã¿ãŸã‚‚ã®ã®ã€ã„ã„æ„Ÿã˜ã«æ”¹å–„ã•ã‚Œãªã„ã®ã§è‡ªå‰ã§å®Ÿè£…ã—ã¦ã‚‹
- XMLã®èª­ã¿ã¨ãé ‘å¼µã‚‹
