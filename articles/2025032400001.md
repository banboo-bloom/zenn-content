---
title: "ã€GASã€‘gBiZ INFO APIã§ä¼æ¥­æƒ…å ±ã‚’å–å¾—ã—ã¦ã¿ã‚‹"
emoji: "ğŸ¦†"
type: "idea"
topics:
  - "GAS"
published: true
published_at: "2025-03-24 20:00"
---

# ãªãœä½œæˆã—ãŸã®ã‹
- ä½•ã‹ã¨ç›®ã«ã™ã‚‹ä¼æ¥­ã®æƒ…å ±ã‚’éƒ½åº¦èª¿ã¹ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã¾ã¨ã‚ã‚‹ã®ãŒé¢å€’ãªã®ã§APIã§æ¥½ã‚’ã—ãŸã„æ°—æŒã¡

# æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- Google Spreadsheet
- GAS
- [gBiz INFO API](https://info.gbiz.go.jp/about/index.html)

# å‚è€ƒ
- APIãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ã‚„åŸºæœ¬çš„ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®ã‚µã‚¤ãƒˆã‚’åŸºã«å­¦ç¿’

https://qiita.com/jfk20tktk04/items/36586833dddc39b13a6c


# ã‚„ã‚ŠãŸã„ã“ã¨
- Appsheetã§æ³•äººç•ªå·ã‚’å—ã‘ä»˜ã‘ã€requestã‚·ãƒ¼ãƒˆã«ç•ªå·ã‚’è¿½åŠ ï¼ˆæœ¬æ›¸ã§ã¯å‰²æ„›ï¼‰
- ã‚·ãƒ¼ãƒˆã¸ã®è¿½åŠ ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã€gBiz INFO APIã§æ³•äººç•ªå·ã‚’ã‚­ãƒ¼ã«ã—ã¦ä¼æ¥­æƒ…å ±ã‚’å–å¾—ã€å–å¾—å¯èƒ½ãªæƒ…å ±ã‚’reportã‚·ãƒ¼ãƒˆã«è¿½åŠ ã™ã‚‹
- reportã‚·ãƒ¼ãƒˆã¸ã®è¿½åŠ ã«æˆåŠŸã—ãŸã‚‰requestã‚·ãƒ¼ãƒˆã®è©²å½“è¡Œã®statusã‚’successã§æ›´æ–°
- ä¼æ¥­æƒ…å ±ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã¯requestã‚·ãƒ¼ãƒˆã®è©²å½“è¡Œã®statusã‚’failedã§æ›´æ–°
- Appsheetã‹ã‚‰reportã‚·ãƒ¼ãƒˆã®æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ï¼ˆæœ¬æ›¸ã§ã¯å‰²æ„›ï¼‰




# GAS

```javascript
// ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾—
const SPREADSHEET_ID = PropertiesService.getScriptProperties().getProperty("SPREADSHEET_ID");
const GBIZINFO_API_URL = "https://info.gbiz.go.jp/api/v1/hojin/"; // gBizINFO APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
const API_KEY = PropertiesService.getScriptProperties().getProperty("GBIZINFO_API_KEY"); // APIã‚­ãƒ¼

/**
 * requestã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã®ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°
 */
function onEdit(e) {
  const sheet = e.source.getSheetByName("request");
  const range = e.range;
  const column = range.getColumn();
  const row = range.getRow();
  
  if (column === 1 && row > 1) {  // 1åˆ—ç›®ï¼ˆæ³•äººç•ªå·åˆ—ï¼‰ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆ
    const corpNo = sheet.getRange(row, 1).getValue();
    if (corpNo) {
      fetchCompanyInfo(corpNo, row);
    }
  }
}

/**
 * gBizINFO APIã‚’ä½¿ç”¨ã—ã¦ä¼æ¥­æƒ…å ±ã‚’å–å¾—
 * @param {string} corpNumber æ³•äººç•ªå·
 * @param {number} row è¡Œç•ªå· (requestã‚·ãƒ¼ãƒˆ)
 */
function fetchCompanyInfo(corpNumber, row) {
  const options = {
    method: 'get',
    // headers: { 'Authorization': `Bearer ${API_KEY}` }
    headers: {
            "Accept": "application/json",
            "X-hojinInfo-api-token": API_KEY
    }
  };

  //const url = `${GBIZINFO_API_URL}?corporateNumber=${corpNumber}`;
  const url = `${GBIZINFO_API_URL}${corpNumber}`;

  try {
    const response = UrlFetchApp.fetch(url, options);
    const data = JSON.parse(response.getContentText());
    
    // if (data && data.corporate_number) {
    if (data && data.id) {
      addReportData(data);
      updateRequestStatus(row, 'success');
    } else {
      updateRequestStatus(row, 'failed');
    }
  } catch (error) {
    console.error(`Error fetching company info: ${error}`);
    updateRequestStatus(row, 'failed');
  }
}

/**
 * reportã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
 * @param {Object} data ä¼æ¥­æƒ…å ±ãƒ‡ãƒ¼ã‚¿
 */
function addReportData(data) {
  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName("report");
  
  const values = [
    data["hojin-infos"][0].corporate_number || '',
    data["hojin-infos"][0].name || '',
    data["hojin-infos"][0].location || '',
    data["hojin-infos"][0].representative_name || '',
    data["hojin-infos"][0].capital_stock || '',
    data["hojin-infos"][0].company_url|| '',
    new Date().toLocaleString()
  ];

  sheet.appendRow(values);
}

/**
 * requestã‚·ãƒ¼ãƒˆã®statusã‚’æ›´æ–°
 * @param {number} row è¡Œç•ªå·
 * @param {string} status ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ('success' ã¾ãŸã¯ 'failed')
 */
function updateRequestStatus(row, status) {
  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName("request");
  sheet.getRange(row, 2).setValue(status);
}

```

# æ‰€æ„Ÿ
- APIã®è¿”ã‚Šå€¤ã®JSONã®ã‚­ãƒ¼å€¤ã«ãƒã‚¤ãƒ•ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåŸå› ã§å€¤ãŒå–ã‚Œã ã›ãªã„ã“ã¨ã«ãªã‹ãªã‹æ°—ã¥ã‘ãšã€ä½™è¨ˆãªæ™‚é–“ã‚’åŠ´ã—ã¦ã—ã¾ã£ãŸ

https://web-dev.hatenablog.com/entry/web/js/lang/access-to-json-hyphen-key

